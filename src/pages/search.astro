---
import Layout from '../layouts/Layout.astro';
import { Card, EnhancedPagination } from '../components';
import { searchComics } from '../infra/api/endpoints/comic';

const query = Astro.url.searchParams.get('q') || '';

const page = Number(Astro.url.searchParams.get('page')) || 1;

const title = `Comics! Search for ${query}`;

const { comics, total, limit } = await searchComics({ query: query, page });
---

<Layout title={title}>
  <h3 class="font-heading text-action text-lg mb-2">{query} ({total})</h3>
  <div class="flex flex-wrap justify-center gap-8 items-start min-h-[26rem]">
    {
      comics.length === 0 && (
        <div class="flex flex-col justify-center items-center min-h-[26rem]">
          <h4 class="font-heading text-action text-2xl mb-2">
            No results found
          </h4>
          <p class="text-fantasy text-center">
            Try searching for something else
          </p>
        </div>
      )
    }
    {
      comics.map((comic) => (
        <Card
          title={comic.title ?? ''}
          price={comic.prices?.[0].price ?? 0}
          image={comic.thumbnail ?? ''}
          url={`/comic/${comic.id}`}
        />
      ))
    }
  </div>
  {
    comics.length > 0 && (
      <div class="flex justify-center items-center mt-8">
        <EnhancedPagination
          total={total}
          page={page}
          limit={limit}
          query={query}
        />
      </div>
    )
  }
</Layout>
